# When a PR is merged into develop, open a PR from develop → staging with the same title and body.
# Requires: Settings → Actions → General → "Allow GitHub Actions to create and approve pull requests" (and org must allow it if applicable).
name: Create PR to Staging

on:
  pull_request:
    types: [closed]

jobs:
  create-staging-pr:
    name: Open PR (develop → staging)
    if: github.event.pull_request.merged == true && github.event.pull_request.base.ref == 'develop'
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    steps:
      - name: Create PR from develop to staging
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const { data } = await github.rest.pulls.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: context.payload.pull_request.title,
              body: context.payload.pull_request.body,
              head: 'develop',
              base: 'staging'
            });
            core.notice(`Created PR #${data.number}: ${data.html_url}`);
